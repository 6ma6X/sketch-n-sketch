<html xmlns="http://www.w3.org/1999/xhtml">
  @(load "src/head.src.html")
<body>
  <div id="wrapper">

    <div id="header">
      <div id="logo"> <h1>Sketch-n-Sketch [Blog]</h1> </div>
      @(load "src/menu.src.html")
    </div>

    <div id="page">

      <div class="content_wide">
      <div class="post0">
        <h3>Posts</h3>
        <ul class="nobullets">
          @(nodejs.listdircontent "src/blog/posts" |> List.reverse
           |> List.map (\(filename, filecontent) ->
             let date = Regex.extract """\*((\w+) (\d+), (\d\d\d\d))\*""" filecontent |>
                Maybe.map (\[date, month, day, year] ->
                  let
                    monthnumericRaw = List.indexOf month ["", "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
                    monthnumeric = if (monthnumericRaw < 10) then """0@monthnumericRaw""" else """@monthnumericRaw"""
                    daynumeric = if (String.length day <= 1) then """0@day""" else day
                  in
                   """@(monthnumeric).@(daynumeric).@year"""
                 ) |>
                Maybe.withDefaultLazy (\() -> "Date not found in " + filename)
             in
             let finalname = Regex.extract """^(.*)\.md$""" filename
                  |> Maybe.map (\[name] -> name + ".html")
                  |> Maybe.withDefaultLazy (\() -> """Filename @filename not a *.md""")
             in
             let title = Regex.extract """# ([^\r\n]+)""" filecontent
                  |> Maybe.map (\[title] ->
                    __evaluate__ __CurrentEnv__ """<span>@title</span>""" |>
                    case of
                      Ok [_, _, children] -> children
                      Err x -> <error>@x</error>)
                  |> Maybe.withDefaultLazy (\() -> <error>[Missing title in @filename]</error>)
             in
             <li><tt>@date:</tt> <a href="""@finalname""">@title</a></li>
           ))
        </ul>
      </div>
      </div>
@("" {-
<!--
      <div class="content_wide_next">
      <div class="post0">
        BLAH
      </div>
      </div>
-->

<!--
      <div id="sidebar">
        <img width="200px" height="200px"
             src="@root/static/images/sketch-n-sketch-logo-gray.svg" />
      </div>

      <div id="sidebar_next">
        <h3>Something Else</h3>
      </div>
-->-})

      <br class="clearfix" />

    </div> @([] {- <!-- end id="page" --> -})

  </div> @([] {- <!-- end id="wrapper" --> -})
  @(load "src/footer.src.html")

  @(load "src/ga-tracker.src.html")
</body>
</html>
